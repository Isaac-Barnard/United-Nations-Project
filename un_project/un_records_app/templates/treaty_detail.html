{% extends 'records_base.html' %}
{% load static %}
{% load custom_filters %}
{% load markdown_extras %}

{% block title %}{{ treaty.title }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/records_styles.css' %}">
{% endblock %}

{% block meta_tags %}
    <!-- Open Graph / Discord -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="{{ treaty.title|truncatechars:70 }}">
    <meta property="og:description" content="{{ treaty.body|preview_text:200 }}">
    <meta property="og:url" content="{{ request.build_absolute_uri }}">
    
    {% if treaty.images.exists %}
        <meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ treaty.images.first.image.url }}">
        <meta property="og:image:alt" content="{{ treaty.title }}">
    {% endif %}
    
    <!-- Additional info -->
    <meta property="article:published_time" content="{{ treaty.date|date:'c' }}">
    <meta property="article:tag" content="Treaty">
    <meta name="description" content="Treaty between {{ treaty.nations_involved.all|join:', ' }} - {{ treaty.body|preview_text:150 }}">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
{% endblock %}

{% block content %}
<div class="page-container">
    <h1 class="resolution-title">
        {{ treaty.title }}
    </h1>

    <p>
        ({{ treaty.date|date:"n/j/Y" }})
        &nbsp;&nbsp;Nations Involved:
        {{ treaty.nations_involved.all|join:", " }}

        {% if treaty.void %}
            <strong>(Void, {{ treaty.invalidation_date|date:"n/j/Y" }})</strong>
        {% endif %}
    </p>
    <hr>
    <div class="resolution-content">
        <div class="resolution-text">
            {{ treaty.body|markdownify }}
        </div>

        {% if treaty.images.exists %}
            <div class="resolution-images
                {% if treaty.images.count == 1 %}
                    single-image
                {% else %}
                    multiple-images
                {% endif %}
            ">
                {% for image in treaty.images.all %}
                <div class="image-container">
                    <img
                        src="{{ image.image.url }}"
                        alt="Image for {{ treaty.title }}"
                        class="resolution-image"
                        onclick="openModal('{{ image.image.url }}', '{{ treaty.title }}')"
                    >
                </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>

    <p>
        <a href="{% url 'treaties' %}">‚Üê Back to all Treaties</a>
    </p>
</div>

<!-- Modal for full-size image viewing -->
<div id="imageModal" class="image-modal" onclick="closeModal()">
    <span class="close-modal" onclick="closeModal()">&times;</span>
    <img class="modal-content" id="modalImage">
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/images.js' %}"></script>
{% endblock %}
