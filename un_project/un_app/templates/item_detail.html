{% extends 'financial_base.html' %}
{% load static %}
{% load custom_filters %}

{% block title %}
    {{ item.name }}
{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'css/item_detail_styles.css' %}">
{% endblock %}

{% block content %}
<div class="item-header">
    <h1>United Nations Details: {{ item.name }}</h1>
    <a href="https://minecraft.wiki/w/{{ item.image_name|urlencode }}" target="_blank" class="wiki-button">
        View the Wiki
    </a>
</div>

<div class="item-detail-container">
    {% if image_url %}
        <div class="item-image-box">
            <img src="{% static image_url %}" alt="{{ item.name }}" class="item-image">
        </div>
    {% else %}
        <div class="item-image-box">
            <p><em>No image available</em></p>
        </div>
    {% endif %}

    <div class="item-description">
        {% if item.description %}
            <p>{{ item.description }}</p>
        {% else %}
            <p><em>No description available</em></p>
        {% endif %}

        {% if item.note %}
            <p><strong>Note:</strong> {{ item.note }}</p>
        {% endif %}
    </div>
</div>

{% if item.price_type == 'market_rate' %}
    <div class="item-evaluations table-half-width">
        <h3><span id="selected-item-name">{{ item.name }} Evaluations:</span></h3>
            <table class="evaluation-table">
            <thead>
                <tr id="evaluation-table-header">
                    <th>Evaluator</th>
                    <th>Total Diamonds</th>
                    {% for denomination in denominations %}
                        <th>{{ denomination.name }}</th>
                    {% endfor %}
                </tr>
            </thead>
            <tbody id="evaluation-table-body">
                {% if evaluation_data %}
                    {% for evaluation in evaluation_data %}
                        <tr>
                            <td>{{ evaluation.evaluator }}</td>
                            <td>{{ evaluation.total_diamond_value|custom_extra_decimal_places }}</td>
                            {% for denomination in denominations %}
                                <td>{{ evaluation.components|get_item:denomination.id|default:0|custom_extra_decimal_places }}</td>
                            {% endfor %}
                        </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="{{ denominations|length|add:2 }}">
                            <em>No evaluations available for this item yet.</em>
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
        <div class="total-line">
        <strong>Total Value:</strong> {{ total_value|custom_extra_decimal_places }} Diamonds
      </div>
    </div>
{% endif %}

{% if item.price_type == 'fixed_price' %}
  {% if item_components or currency_components %}
    <div class="price-breakdown table-half-width">
      <h3><span id="selected-item-name">{{ item.name }} Price Breakdown:</span></h3>

      {% if item_components %}
        <table class="breakdown-table">
          <thead>
            <tr>
              <th>Denomination</th>
              <th>Amount</th>
              <th>Diamond Equivalent</th>
            </tr>
          </thead>
          <tbody>
            {% for component in item_components %}
              <tr>
                <td>{{ component.name }}</td>
                <td>{{ component.quantity|custom_extra_decimal_places }}</td>
                <td>{{ component.worth|custom_extra_decimal_places }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}

      {% if currency_components %}
        <table class="breakdown-table">
          <thead>
            <tr>
              <th>Referenced Item</th>
              <th>Percentage</th>
              <th>Item Base Price</th>
              <th>Diamond Equivalent</th>
            </tr>
          </thead>
          <tbody>
            {% for component in currency_components %}
              <tr>
                <td>{{ component.name }}</td>
                <td>{{ component.percentage|custom_charter_decimal_places }}%</td>
                <td>{{ component.referenced_price|custom_extra_decimal_places }}</td>
                <td>{{ component.worth|custom_extra_decimal_places }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% endif %}

      <div class="total-line">
        <strong>Total Value:</strong> {{ total_value|custom_extra_decimal_places }} Diamonds
      </div>
    </div>
  {% endif %}
{% endif %}


{% endblock %}
